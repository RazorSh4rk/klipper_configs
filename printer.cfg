[include kiauh_macros.cfg]
[include custom_macros.cfg]
#[include glyphs.cfg]
#[include neopixel_macros.cfg]
#[include coprocessor.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f103xe_32FFDB054B4E313126800243-if00

[virtual_sdcard]
path: ~/gcode_files

#[display]
#lcd_type: ssd1306
#i2c_mcu: mcu
#i2c_bus: i2c1a

#[display]
#lcd_type: st7920
#cs_pin: EXP1_7
#sclk_pin: EXP1_6
#sid_pin: EXP1_8
#encoder_pins: ^EXP1_5, ^EXP1_3
#click_pin: ^!EXP1_2

[output_pin beeper]
pin: EXP1_1

[bltouch]
stow_on_each_sample: False
probe_with_touch_mode: True
sensor_pin: ^PC14
control_pin: PA1
pin_move_time: 0.5
pin_up_touch_mode_reports_triggered: False
x_offset: -43
y_offset: -13
z_offset: 0.65
speed: 10
lift_speed: 20
samples: 3
sample_retract_dist: 5
samples_tolerance_retries: 3

[screws_tilt_adjust]
horizontal_move_z: 10
screw1: 70,200
screw1_name: back left
screw2: 235,200
screw2_name: back right
screw3: 70,47
screw3_name: front left
screw4: 235,47
screw4_name: front right

[force_move]
enable_force_move: True

[safe_z_home]
home_xy_position: 161.5,131.5
speed: 150
z_hop: 15
z_hop_speed: 20

[bed_mesh]
speed: 250
horizontal_move_z: 6
mesh_min: 10, 10
mesh_max: 192,187
probe_count: 21
mesh_pps: 2,2
algorithm: bicubic

[stepper_x]
step_pin: PB13
dir_pin: !PB12
enable_pin: !PB14
microsteps: 16
rotation_distance: 40
endstop_pin: ^PC0
position_endstop: 0
position_max: 235
homing_speed: 50

[tmc2209 stepper_x]
uart_pin: PC11
tx_pin: PC10
uart_address: 0
run_current: 0.580
stealthchop_threshold: 999999

[stepper_y]
step_pin: PB10
dir_pin: !PB2
enable_pin: !PB11
microsteps: 16
rotation_distance: 40
endstop_pin: ^PC1
position_endstop: -10
position_min = -10
position_max: 225
homing_speed: 50

[tmc2209 stepper_y]
uart_pin: PC11
tx_pin: PC10
uart_address: 2
run_current: 0.580
stealthchop_threshold: 999999

[stepper_z]
step_pin: PB0
dir_pin: PC5
enable_pin: !PB1
microsteps: 16
rotation_distance: 8
endstop_pin: probe:z_virtual_endstop
#endstop_pin: ^PC2
#position_endstop: 0.0
position_max: 250
position_min: -2

[tmc2209 stepper_z]
uart_pin: PC11
tx_pin: PC10
uart_address: 1
run_current: 0.580
stealthchop_threshold: 999999

[extruder]
step_pin: PB3
dir_pin: !PB4
enable_pin: !PD2
microsteps: 16
full_steps_per_rotation: 200
gear_ratio: 3:1
rotation_distance: 23.132
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: PC8
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PA0
control: pid
pid_Kp: 21.527
pid_Ki: 1.063
pid_Kd: 108.982
min_temp: 0
max_temp: 250
pressure_advance: 0.095

[tmc2209 extruder]
uart_pin: PC11
tx_pin: PC10
uart_address: 3
run_current: 0.650
stealthchop_threshold: 999999

[heater_bed]
heater_pin: PC9
sensor_type: ATC Semitec 104GT-2
sensor_pin: PC3
control: pid
pid_Kp: 54.027
pid_Ki: 0.770
pid_Kd: 948.182
min_temp: 0
max_temp: 130

[heater_fan nozzle_cooling_fan]
pin: PC7

[fan]
pin: PC6

[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 5000
max_z_velocity: 5
max_z_accel: 100

[static_digital_output usb_pullup_enable]
pins: !PA14

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8,  EXP1_9=<GND>,
    EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB15, EXP1_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.485000, 0.446667, 0.411667, 0.395833, 0.349167, 0.399167, 0.310833, 0.317500, 0.268333, 0.318333, 0.270833, 0.227500, 0.232500, 0.201667, 0.201667, 0.246667, 0.159167, 0.152500, 0.159167, 0.156667, 0.146667
#*# 	  0.483333, 0.475833, 0.402500, 0.360833, 0.290000, 0.335833, 0.326667, 0.280000, 0.320833, 0.284167, 0.210000, 0.210833, 0.240833, 0.202500, 0.204167, 0.148333, 0.167500, 0.151667, 0.189167, 0.130000, 0.161667
#*# 	  0.414167, 0.421667, 0.380833, 0.365000, 0.357500, 0.312500, 0.306667, 0.263333, 0.281667, 0.247500, 0.180000, 0.190000, 0.155000, 0.157500, 0.165833, 0.152500, 0.146667, 0.079167, 0.117500, 0.085833, 0.153333
#*# 	  0.445000, 0.416667, 0.433333, 0.348333, 0.320000, 0.351667, 0.307500, 0.303333, 0.300000, 0.238333, 0.262500, 0.217500, 0.206667, 0.187500, 0.153333, 0.190000, 0.192500, 0.139167, 0.114167, 0.093333, 0.140833
#*# 	  0.362500, 0.370000, 0.325833, 0.258333, 0.310833, 0.235833, 0.260833, 0.219167, 0.231667, 0.189167, 0.194167, 0.112500, 0.103333, 0.090833, 0.147500, 0.133333, 0.123333, 0.075833, 0.079167, 0.066667, 0.102500
#*# 	  0.374167, 0.368333, 0.286667, 0.270833, 0.229167, 0.231667, 0.234167, 0.205833, 0.160000, 0.173333, 0.140000, 0.120000, 0.130000, 0.110833, 0.126667, 0.101667, 0.063333, 0.058333, 0.033333, 0.035833, 0.010000
#*# 	  0.328333, 0.319167, 0.248333, 0.280833, 0.224167, 0.202500, 0.175000, 0.170833, 0.177500, 0.156667, 0.143333, 0.095833, 0.085833, 0.100000, 0.052500, 0.064167, 0.039167, 0.016667, 0.064167, -0.006667, 0.075000
#*# 	  0.386667, 0.328333, 0.275833, 0.236667, 0.260000, 0.221667, 0.229167, 0.205000, 0.145000, 0.170000, 0.131667, 0.085833, 0.058333, 0.119167, 0.136667, 0.136667, 0.101667, 0.067500, 0.040833, 0.012500, 0.028333
#*# 	  0.330000, 0.303333, 0.255000, 0.247500, 0.215000, 0.205000, 0.210000, 0.157500, 0.141667, 0.103333, 0.120833, 0.084167, 0.065833, 0.097500, 0.071667, 0.066667, 0.025000, 0.003333, 0.003333, -0.028333, -0.007500
#*# 	  0.293333, 0.280000, 0.219167, 0.200000, 0.175833, 0.169167, 0.191667, 0.170000, 0.143333, 0.131667, 0.082500, 0.054167, 0.047500, 0.074167, 0.047500, 0.045833, 0.044167, 0.041667, -0.011667, -0.010833, 0.033333
#*# 	  0.245833, 0.226667, 0.225000, 0.193333, 0.172500, 0.166667, 0.140833, 0.145833, 0.126667, 0.060833, 0.013333, 0.061667, 0.019167, -0.001667, 0.045833, 0.013333, -0.015833, -0.050833, -0.041667, -0.041667, -0.068333
#*# 	  0.237500, 0.187500, 0.185000, 0.143333, 0.167500, 0.122500, 0.115833, 0.134167, 0.122500, 0.054167, 0.071667, 0.037500, 0.010000, 0.040833, 0.042500, -0.002500, 0.004167, -0.014167, 0.005000, -0.043333, -0.010833
#*# 	  0.220000, 0.142500, 0.165833, 0.135833, 0.114167, 0.080833, 0.052500, 0.120833, 0.042500, -0.000833, 0.006667, 0.021667, -0.006667, -0.025833, -0.040833, 0.017500, -0.065833, -0.069167, -0.073333, -0.114167, -0.135000
#*# 	  0.175833, 0.124167, 0.084167, 0.090000, 0.080833, 0.047500, 0.028333, 0.002500, 0.027500, 0.005000, -0.040000, -0.020000, -0.074167, -0.082500, -0.045833, -0.050833, -0.057500, -0.100833, -0.100000, -0.138333, -0.121667
#*# 	  0.171667, 0.138333, 0.100833, 0.055833, 0.061667, 0.023333, -0.000000, 0.030833, 0.048333, -0.055833, -0.073333, -0.085000, -0.082500, -0.095000, -0.135000, -0.085833, -0.130000, -0.157500, -0.167500, -0.130833, -0.177500
#*# 	  0.177500, 0.125000, 0.089167, 0.095833, 0.044167, 0.025833, 0.026667, -0.007500, -0.029167, -0.024167, -0.011667, -0.022500, -0.108333, -0.064167, -0.116667, -0.107500, -0.068333, -0.074167, -0.091667, -0.094167, -0.138333
#*# 	  0.145000, 0.132500, 0.112500, 0.046667, 0.047500, 0.064167, -0.004167, 0.030833, 0.016667, -0.044167, -0.039167, -0.064167, -0.086667, -0.145000, -0.106667, -0.120833, -0.137500, -0.168333, -0.158333, -0.205000, -0.158333
#*# 	  0.075833, 0.070000, 0.038333, 0.008333, -0.014167, -0.009167, -0.040000, -0.049167, -0.038333, -0.086667, -0.090000, -0.057500, -0.095833, -0.081667, -0.094167, -0.118333, -0.135833, -0.150000, -0.126667, -0.150833, -0.148333
#*# 	  0.120833, 0.047500, 0.008333, 0.003333, 0.023333, -0.045833, -0.068333, -0.105000, -0.060833, -0.095000, -0.110833, -0.154167, -0.109167, -0.164167, -0.141667, -0.169167, -0.180000, -0.177500, -0.221667, -0.199167, -0.231667
#*# 	  0.035000, 0.034167, 0.010833, -0.077500, -0.043333, -0.033333, -0.054167, -0.011667, -0.075833, -0.130833, -0.154167, -0.141667, -0.111667, -0.133333, -0.112500, -0.120000, -0.152500, -0.128333, -0.215833, -0.147500, -0.145000
#*# 	  0.045000, 0.027500, 0.002500, -0.068333, -0.054167, -0.043333, -0.079167, -0.107500, -0.126667, -0.149167, -0.129167, -0.160833, -0.215000, -0.145833, -0.166667, -0.208333, -0.226667, -0.199167, -0.247500, -0.270000, -0.262500
#*# tension = 0.2
#*# min_x = 10.0
#*# algo = bicubic
#*# y_count = 21
#*# mesh_y_pps = 2
#*# min_y = 10.0
#*# x_count = 21
#*# max_y = 187.0
#*# mesh_x_pps = 2
#*# max_x = 192.0
